# Space Syntax解析システム要件定義書

## 1. プロジェクト概要

### 1.1 目的
OpenStreetMapデータを活用したSpace Syntax理論に基づく都市空間構造の解析システムを構築する。

### 1.2 対象範囲
- OpenStreetMapからの道路ネットワークデータ取得
- Space Syntax指標の計算と解析
- 可視化とレポート生成

## 2. 機能要件

### 2.1 データ取得機能
- **F001**: OpenStreetMapからの道路ネットワークデータ取得
  - 指定された地域の道路ネットワークを取得
  - 歩行者ネットワーク、自動車ネットワークの選択的取得
  - データの前処理と正規化

### 2.2 グラフ変換機能
- **F002**: Axial Map生成
  - 道路中心線からのAxial Lineの自動生成
  - 交差点での線分分割処理
  - グラフトポロジーの構築

- **F003**: Segment Map生成
  - 道路セグメント単位での解析
  - 角度変化に基づくセグメント分割

### 2.3 Space Syntax解析機能
- **F004**: Integration値計算
  - Global Integration（Rn）
  - Local Integration（R3, R5等）
  - Normalized Integration（NAIN）

- **F005**: Connectivity値計算
  - 直接接続数の計算
  - ノード接続性の評価

- **F006**: Choice値計算
  - Global Choice（Angular Choice）
  - Local Choice（限定半径での経路選択）
  - Normalized Choice（NACH）

- **F007**: Depth値計算
  - Mean Depth（平均深度）
  - 特定ノードからの深度分析

- **F008**: Intelligibility値計算
  - ConnectivityとIntegrationの相関分析
  - 空間認知性の評価

### 2.4 統計分析機能
- **F009**: 基本統計量計算
  - 平均値、中央値、標準偏差
  - 分布の歪度・尖度

- **F010**: 相関分析
  - 各指標間の相関係数計算
  - 回帰分析

### 2.5 可視化機能
- **F011**: 地図可視化
  - 各Space Syntax指標の色分けマップ
  - インタラクティブマップの生成

- **F012**: グラフ可視化
  - ヒストグラム、散布図
  - 相関マトリックス
  - 時系列分析グラフ

### 2.6 レポート出力機能
- **F013**: 解析レポート生成
  - PDF形式での総合レポート
  - 統計表とグラフの自動生成

## 3. 非機能要件

### 3.1 性能要件
- **NF001**: 処理時間
  - 中規模都市（10,000ノード以下）で5分以内の処理完了
  - 大規模データ処理時の進捗表示

### 3.2 可用性要件
- **NF002**: エラーハンドリング
  - ネットワーク接続エラーの適切な処理
  - データ不整合時の警告表示

### 3.3 保守性要件
- **NF003**: モジュール設計
  - 各機能の独立したモジュール化
  - 設定可能なパラメータの外部化

## 4. 技術要件

### 4.1 開発環境
- Python 3.8以上
- NetworkX 2.5以上
- OSMnx 1.0以上
- GeoPandas
- Matplotlib/Plotly

### 4.2 入力データ形式
- OpenStreetMap XML/PBF形式
- GeoJSON形式
- Shapefile形式

### 4.3 出力データ形式
- CSV（統計データ）
- GeoJSON（空間データ）
- PNG/SVG（可視化画像）
- PDF（レポート）

## 5. ユーザーインターフェース要件

### 5.1 コマンドライン界面
- **UI001**: 地域指定方式
  - 地名による指定
  - 緯度経度による境界指定
  - 行政区域による指定

### 5.2 設定ファイル
- **UI002**: 解析パラメータ設定
  - 解析半径の設定
  - 出力形式の選択
  - 可視化オプション

## 6. セキュリティ要件

### 6.1 データ保護
- **S001**: 個人情報保護
  - 公開データのみの使用
  - プライバシーに配慮した解析

## 7. 制約条件

### 7.1 技術的制約
- OpenStreetMapデータの品質に依存
- 計算量の複雑さによる処理時間制限

### 7.2 法的制約
- OpenStreetMapライセンス（ODbL）の遵守
- 各国の地図利用規制の遵守

## 8. 今後の拡張計画

### 8.1 フェーズ2機能
- リアルタイム解析機能
- 時系列変化分析
- 複数都市比較機能

### 8.2 フェーズ3機能
- 機械学習による予測機能
- WebAPI提供
- クラウド対応

### 9. 画面フロー

```mermaid
graph TD
    A[システム起動] --> B[設定ファイル読み込み]
    B --> C[地域指定方式選択]
    
    C --> D1[地名指定]
    C --> D2[緯度経度指定]
    C --> D3[行政区域指定]
    
    D1 --> E[OSMデータ取得]
    D2 --> E
    D3 --> E
    
    E --> F[データ前処理]
    F --> G[グラフ構造構築]
    
    G --> H[解析方式選択]
    H --> I1[Axial Map解析]
    H --> I2[Segment Map解析]
    
    I1 --> J1[Axial Line生成]
    I2 --> J2[セグメント分割]
    
    J1 --> K[Space Syntax指標計算]
    J2 --> K
    
    K --> L1[Integration計算]
    K --> L2[Connectivity計算]
    K --> L3[Choice計算]
    K --> L4[Depth計算]
    
    L1 --> M[統計分析]
    L2 --> M
    L3 --> M
    L4 --> M
    
    M --> N[可視化処理]
    N --> O1[地図可視化]
    N --> O2[グラフ可視化]
    
    O1 --> P[結果出力]
    O2 --> P
    
    P --> Q1[CSVエクスポート]
    P --> Q2[画像エクスポート]
    P --> Q3[PDFレポート]
    
    Q1 --> R[処理完了]
    Q2 --> R
    Q3 --> R
